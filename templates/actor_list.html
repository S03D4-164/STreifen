{% extends "base.html" %}

{% block title %}
<title>Threat Actor</title>
{% endblock %}

{% block visjslib %}{% endblock %}

{% block jquery %}
<script type="text/javascript" src="/static/d3/d3.js"></script>
<link rel="stylesheet" type="text/css" href="/static/psd3/psd3.css">
<script type="text/javascript" src="/static/psd3/psd3.js"></script>

<script>
function ChangeRight(id){
    $.ajax({
        "url":"/vis/actor/" + id,
        "type":"GET",
        "success":function(result){
            data = $(result).find("#vis");
            $("#vis").html(data);
        }
    });
};
$(document).ready(
    function(){
        $('a[data-toggle="tab"]').on( 'shown.bs.tab', function (e) {
            $.fn.dataTable.tables( {visible: true, api: true} ).columns.adjust();
        } );
	$('#actor_table').dataTable({
            "processing":true,
            "serverSide":true,
            "ajax": "{% url 'threatactor_data' %}",
            "order":[0, 'desc'],
        });
        //$('#id_firstseen').datetimepicker({
        //        format:'Y-m-d H:i'
        //});
    }
);
</script>
{% endblock%}

{% block container %}

{% block modal %}
<div class="modal" id="actor_form" role="dialog">
<div class="modal-dialog">
<div class="modal-content">

<div class="modal-header">
<button type="button" class="close" data-dismiss="modal">&times;</button>
<h4 class="modal-title">Create Threat Actor</h4>
</div>

<div class="modal-body">
<form method=post>{% csrf_token %}

<div><p>Name:</p>
{{form.name}}
</div>
<hr>
<div class="col-md-12">

<div class="col-md-5">
<p>Labels:</p>
{{form.labels}}
</div>

<div class="col-md-7">
<p>Description:</p>
{{form.description}}
</div>

</div>

<input class="btn btn-primary btn-sm" type="submit" name="create" value="create">
</form>
</div><!--/.modal-body-->

</div><!--/.modal-content-->
</div><!--/.modal-dialog-->
</div><!--/.modal-->
{% endblock %}

<div class="col-md-12">

<div id="left_pane" class="col-md-6">
<h3 style="margin-top: 0">Threat Actor
<a class="btn btn-primary btn-sm" data-toggle="modal" href="#actor_form">Create</a>
</h3>
<hr>
<table id="actor_table" class="table table-condensed table-stripe table-hover display" width="100%">
<thead><tr>
<th class="col-md-2">ID</th>
<th class="col-md-4">Name</th>
<th class="col-md-6">Alias</th>
</tr></thead>
</table>
</div><!--/#left_pane-->

<div id="right_pane" class="col-md-6" >
<div class="panel panel-primary">

<div class="panel-heading">
Target Stats
</div>
<div class="panel-body">
<div id="vis">
<div class="col-md-12" id="chartContainer" style="position:relative;"></div>
<script type="text/javascript">
var data = [{% for actor, target in data.items %}
    {
        value: {{target.value}},
        label: "{{actor}}",
        inner:[{% for label, value in target.inner.items %}
        {
            value: {{value}},
            label: "{{label}}",
        },
        {% endfor %}]
    },
    {% endfor %}];
var config = {
    containerId: "chartContainer",
    width: 500,
    height: 500,
    data: data,
    label: function(d) {return d.data.label + ":" + d.data.value;},
    tooltip: function(d) {return d.label + ":" + d.value ;},
    transition: "linear",
    transitionDuration: 100,
    donutRadius: 50,
    gradient: false,
    colors: d3.scale.category20(),
    stroke: "#eee",
    strokeWidth: 3,
    highlightColor: "#c00"

};
var pie = new psd3.Pie(config);
</script>
</div>
</div><!--/.panel-body-->
</div><!--/.panel-->
</div><!--/.col-md-6-->

{% endblock %}
