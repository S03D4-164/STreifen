{% extends "report_list.html" %}

{% block title %}
<title>{{report.name}}</title>
{% endblock %}

{% block jquery %}
<script>
$(document).ready(
        function(){
       		$(".report_form").toggle();
		$('.btn-toggle').click(function(){
			if($(this).attr("value")=="report_form"){
       				$(".report_form").toggle();
	       		};
	       	});
                $('a[data-toggle="tab"]').on( 'shown.bs.tab', function (e) {
                    $.fn.dataTable.tables( {visible: true, api: true} ).columns.adjust();
                } );
                $('#identity_table').dataTable({
                    "processing":true,
                    "serverSide":true,
                    "ajax": {
                        //"url": "/data/identity",
                        //"data": {'subcluster':{{cluster.id}}},
                    },
                    "order":[0, 'desc'],
                });
                //$('#id_firstseen').datetimepicker({
                //        format:'Y-m-d H:i'
                //});
                function table_btn(b){
                };
                $('tbody').on('click', '.btn', function (e) {
                        table_btn($(this));
                });
	}
);
</script>
{% endblock%}

{% block container %}

<div class="modal" id="report_form" role="dialog">
<div class="modal-dialog"><div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal">&times;</button>
<h4 class="modal-title">Edit Report</h4>
</div>
<div class="modal-body">
<form method=post>{% csrf_token %}
<table class="table table-condensed">
<div>
Name:
{{form.name}}
</div>
<div>
Published:
{{form.published}}
</div>
<hr>
<div class="col-sm-4">
Labels:
{{form.labels}}
</div>
<div class="col-sm-4">
Object Refs:
{{form.object_refs}}
</div>
<div class="col-sm-4">
Description:
{{form.description}}
</div>
</table>
<input class="btn btn-primary btn-sm" type="submit" name="update" value="Update">
<input class="btn btn-danger btn-sm" type="submit" name="delete" value="Delete">
<!--
<br><br>
<input class="btn btn-info btn-sm" type="submit" name="push_all" value="Push All Entity">
<input class="btn btn-warning btn-sm" type="submit" name="remove_all" value="Remove All Entity">
<input class="btn btn-danger btn-sm" type="submit" name="delete_all" value="Delete All Entity">
-->
</form>
</div><!--/.modal-body-->
</div><!--/.modal-content-->
</div><!--/.modal-dialog-->
</div><!--/.modal-->

<div class="col-md-5" id="report" >
<div class="panel panel-primary">
<div class="panel-heading">
<a data-toggle="collapse" href="#collapse1" style="color:white">
{{report.object_id}}
<a class="btn btn-primary btn-xs" data-toggle="modal" href="#report_form">Edit</a>
</a>
</div><!--.panel-heading-->
<div id="collapse1" class="panel-collapse collapse in">
<div class="panel-body">
<table class="table table-condensed">
<tr>
<th class="col-md-3">Name</th><td>{{report.name}}</td></tr>
<th >Created</th><td>{{report.created}}</td></tr>
<th >Modified</th><td>{{report.modified}}</td></tr>
<th >Published</th><td>{{report.published}}</td></tr>
<tr><th>Labels</th>
<td>
{% for l in report.labels.all %}
{{l.value}}<br>
{% endfor %}
</td></tr>
<tr>
<th >Description</th>
<td><pre>{{report.description}}</pre></td>
</tr>
</table>
</div><!--/.panel-body-->
</div><!--/collapse-->
</div><!--.panel-->
</div><!--/report-->


<div class="col-md-7" id="accordion" >
<div class="panel panel-default">
<div class="panel-heading">
<a data-toggle="collapse" data-parent="#accordion" href="#collapse3" >
Add Object
</a></div><!--.panel-heading-->
<div id="collapse3" class="panel-collapse collapse">
<div class="panel-body">
<form method=post>{% csrf_token %}
<table class="table">
<tr><th class="col-md-3"></th><td></td></tr>
{{relform.as_table}}
</table>
<input class="btn btn-primary btn-md" type="submit" name="create" value="Create">
</form>
</div><!--/.panel-body-->
</div><!--.collapse-->

<div class="panel-heading">
<a data-toggle="collapse" data-parent="#accordion" href="#collapse2" >
Use Template
</a>
</div>
<div id="collapse2" class="panel-collapse collapse">
<div class="panel-body">
<form method=post>{% csrf_token %}
<table class="table">
<tr><th class="col-md-3"></th><td></td></tr>
{{tform.as_table}}
</table>
<input class="btn btn-primary btn-md" type="submit" name="create_relation" value="Create">
</form>
</div><!--/.panel-body-->
</div>
</div><!--/.panel-->

<!--
<div class="btn-group">
<a class="btn btn-info" data-toggle="collapse" href="#network">Visualize</a>
<a class="btn btn-primary" href="?vis=1">Show</a>
<a class="btn btn-primary" href="?vis=2">Anonymize</a>
<a class="btn btn-primary" href="?vis=0">Hide</a>
<a class="btn btn-primary" href="/visualize/subcluster/{{cluster.id}}">Large View</a>
<a class="btn btn-primary" href="/vis_anonymize/subcluster/{{cluster.id}}">Large View(Anonymized)</a>
</div>
{% if dataset %}
<div style="margin: 0 auto;" id="network" ></div>
<script type="text/javascript">
var nodes = [
{% for n in dataset.nodes %}{
        'id':'{{n.id}}',
        'label':'{{n.label}}',
        'group':'{{n.group}}',
        'title': '<table>{% for t in n.title %}<tr><td>{{t|escapejs}}</td></tr>{% endfor %}</table>',
},
{% endfor %}];
var edges = [
{% for e in dataset.edges %}{
        'from':'{{e.from}}',
        'to':'{{e.to}}',
        'label':'{{e.label}}',
        'title': '<table>{% for t in e.title %}<tr><td>{{t|escapejs}}</td></tr>{% endfor %}</table>',
},
{% endfor %}];
var container = document.getElementById('network');
var data = {
        nodes: nodes,
        edges: edges
};
options = visOption();
options.layout = {"randomSeed":1};
var network = new vis.Network(container, data, options);
</script>
{% endif %}
</div>
-->


<ul class="nav nav-pills">
  <li class="active"><a data-toggle="tab" href="#node">Identity</a></li>
  <li ><a data-toggle="tab" href="#relation">Attack Pattern</a></li>
  <li ><a data-toggle="tab" href="#cluster">Relation</a></li>
</ul>

<div class="tab-content">

<div class="tab-pane active" id="identity" >
<table id="identity_table" class="table table-condensed table-stripe table-hover display" width="100%">
<thead><tr>
<th class="col-sm-1">ID</th>
<th class="col-sm-1">Ref</th>
<th class="col-sm-2">Created</th>
<th class="col-sm-2">Value</th>
</tr></thead>
</table>
</div><!--/#identity-->

<div class="tab-pane" id="attack-pattern" >
<table id="attack-pattern_table" class="table table-condensed table-stripe table-hover display" width="100%">
<thead>
<th class="col-sm-1">ID</th>
<th class="col-sm-1">Ref</th>
<th class="col-sm-2">First seen</th>
</thead>
</table>
</div><!--/#attack-pattern-->

</div><!--/tab-content-->

</div><!--/.col-md-7-->

</div>

{% endblock %}
